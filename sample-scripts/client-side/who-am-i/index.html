<html><head>
<script>
let hashArguments = document.location.hash.slice(1).split('&')
	.map(pair=>pair.split('='))
	.reduce((obj,parts)=>({...obj,[decodeURIComponent(parts[0])]:decodeURIComponent(parts.slice(1).join('='))}),{})
function api(endpoint,{token, qs={}, body}={}){
	return new Promise((res,rej)=>{
		let match = endpoint.match("^(GET|POST|PUT|PATCH|DELETE)? ?(.*)$")
		let method = match[1]||"GET"
		let path = match[2]
		let request = new XMLHttpRequest()
		request.open(method, 
			"https://"+hashArguments.cfnCors+"/"+hashArguments.lkrApiHost
			+"/api/3.0/"+path
			+(method.includes("?")?"&":"?")
			+Object.entries(qs).map(([k,v])=>encodeURIComponent(k)+"="+encodeURIComponent(v)).join("&")
			, true)
		if(method!="GET"){request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8')}
		request.setRequestHeader('Authorization', "token "+(token||hashArguments.token))
		request.onload = res
		request.onerror = rej
		request.send(body==undefined?undefined:JSON.stringify(body))
		})
	}
</script>
<body></body>
<script>
!async function(){

document.body.innerHTML = JSON.stringify(await api("user"),undefined,2)

}()
</script>
</html>